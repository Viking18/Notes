###c语言编译过程

![20160427234233115](/Users/jingwei/Documents/笔记/图片/20160427234233115.png)

编译共分为四个阶段：预处理阶段、编译阶段、汇编阶段、链接阶段。

1、预处理阶段：

​       主要工作是将头文件插入到所写的代码中，生成扩展名为“.i”的文件替换原来的扩展名为“.c”的文件，但是原来的文件仍然保留，只是执行过程中的实际文件发生了改变。（这里所说的替换并不是指原来的文件被删除）

```shell
使用以下命令来进行预处理：
gcc -E *.c -o *.i
```

2、编译阶段：

​       插入汇编语言程序，将代码翻译成汇编语言。编译器首先要检查代码的规范性、是否有语法错误等，以确定代码的实际要做的工作，在检查无误后，编译器把代码翻译成汇编语言，同时将扩展名为“.i”的文件翻译成扩展名为“.s”的文件。

```  shell
使用一下指令进行编译：
gcc –S *.i –o *.s
```

3、汇编阶段：

将汇编语言翻译成机器语言指令，并将指令打包封存成可重定位目标程序的格式,将扩展名为“.s”的文件翻译成扩展名为“.o”的二进制文件。

```shell
gcc –c *.c –o *.o
```

4、链接阶段:

​       在示例代码中，改代码文件调用了标准库中printf函数。而printf函数的实际存储位置是一个单独编译的目标文件（编译的结果也是扩展名为“.o”的文件），所以此时主函数调用的时候，需要将该文件（即printf函数所在的编译文件）与hello world文件整合到一起，此时链接器就可以大显神通了，将两个文件合并后生成一个可执行目标文件。



### 库文件

1. 静态库文件

   一般文件后缀名为.a(linux) .lib(windows)，存档文件(Archive)，就是一系列***目标文件的集合***，是一个二进制文件，存放的功能函数实现。当你提供一个存档文件给链接器的时候，链接器会在存档文件中寻找所需的目标文件，提取他们，然后与链接单个的目标文件一样链接到你的程序当中。

   在编译阶段直接把静态库加入到可执行文件中去，这样可执行文件会比较大。在文件编译时要访问文件,编译之后静态库文件可以删除。

2. 动态库文件

   一般文件后缀名为.so(linux) .dll(windows). 共享库文件，也是一系列目标文件的集合，是一个二进制文件,存放的功能函数实现。当一个动态链接库被链接到一个程序的时候，程序的最终可执行文件并不真的包含动态链接库中的代码。而是在可执行文件当中包含一个动态链接库的引用。

   连接阶段仅仅只加入一些描述信息，而程序执行时再从系统中把相应动态库加载到内存中去。在文件执行时要访问文件,编译时不需要动态库文件

   ```shell
   g++ xxxx -L 库路径 -l库名称
   ```

   



